<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Xenokuni - Turn-Based RPG</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">

  <style>
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background-color: #f4f6f9;
      color: #333;
      scroll-behavior: smooth;
    }
    header h1 {
      font-size: 3rem;
      letter-spacing: -1px;
    }
    .container {
      max-width: 900px;
    }
    section {
      background: #fff;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      margin-top: 2rem;
    }
    pre {
      border-radius: 8px;
      padding: 1rem;
      font-size: 0.9rem;
    }
    figcaption {
      font-size: 0.9rem;
      color: #666;
    }
    hr {
      border-color: #ccc;
    }
    /* Botón fijo */
    .home-button {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 9999;
      background: #343a40;
      color: #fff;
      border: none;
      border-radius: 50px;
      padding: 10px 18px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      transition: background 0.3s;
    }
    .home-button:hover {
      background: #212529;
    }
  </style>
</head>
<body>

  <button class="home-button" onclick="window.location.href='../index.html'">← Home</button>

  <div class="container py-5">
    <header class="mb-5 text-center">
      <h1 class="fw-bold">Xenokuni</h1>
      <p class="text-muted">A turn-based RPG built in Unity with modular systems and data persistence</p>
      <hr class="w-25 mx-auto">
    </header>

    <!-- SECTION 1: Overview -->
    <section>
      <h2>Overview</h2>
      <p>
        <strong>Xenokuni</strong> is a story-driven turn-based RPG built in Unity. I inteded to release this as an early access game for the indie project of Cover Id, but with my lack of artistic skill will be difficult. The combat system is implemented through a <strong>State Machine</strong> architecture, 
        the story progression relies on <strong>serialized data persistence</strong>, and the dialogue engine is based on 
        <strong>JSON event-driven scripts</strong>.
      </p>
      <figure class="text-center">
        <img src="../img/Xenokuni.jpg" alt="Xenokuni battle screen" class="img-fluid rounded shadow-sm my-3">
        <figcaption>Battle prototype of Xenokuni</figcaption>
      </figure>
    </section>

    <!-- SECTION 2: Combat State Machine -->
    <section>
      <h2>Combat System</h2>
      <p>
        The combat in Xenokuni is governed by a clear <strong>finite state machine (FSM)</strong>. Each combat phase is encapsulated
        as a state derived from <code>CombatState</code>, ensuring modular transitions and easy debugging.
      </p>

      <h4>Base Combat State</h4>
      <pre><code class="language-csharp">
public abstract class CombatState
{
    protected CombatManager manager;

    public CombatState(CombatManager manager)
    {
        this.manager = manager;
    }

    public abstract void Enter();
    public abstract void Execute();
    public abstract void Exit();
}
      </code></pre>

      <h4>Player Turn Example</h4>
      <pre><code class="language-csharp">
public class PlayerTurnState : CombatState
{
    private PlayerSubState currentSubState;

    public PlayerTurnState(CombatManager m) : base(m) { }

    public override void Enter()
    {
        manager.CurrentUnit = manager.playerUnits.First();
        StartUnitTurn();
    }

    public override void Execute()
    {
        currentSubState?.Execute();
    }

    public override void Exit()
    {
        Debug.Log("Player turn end");
    }

    public void StartUnitTurn()
    {
        Debug.Log($"Is {manager.CurrentUnit.name}'s turn");
        manager.CurrentUnit.ToggleActiveIndicator(true);
        ChangeSubState(new PlayerChooseActionState(this));
    }
}
      </code></pre>

      <p>
        This modular design allows transitions between states such as <code>EnemyTurnState</code> or <code>VictoryState</code>
        with minimal coupling. Each substate (e.g., choosing an action, selecting a target, executing a spell)
        inherits from <code>PlayerSubState</code>.
      </p>
    </section>

    <!-- SECTION 3: Persistent Data System -->
    <section>
      <h2>Data Persistence</h2>
      <p>
        To support RPG features like story progression, inventory, and relationships, <strong>Xenokuni</strong> implements
        a JSON-based save system through Unity’s <code>JsonUtility</code>. All data is encapsulated in serializable classes:
      </p>

      <pre><code class="language-csharp">
[System.Serializable]
public class PersistentUnit
{
    public string UnitId;
    public string DisplayName;
    public int baseMaxLife, life, baseMaxMana, curMana, baseAttack, baseSpeed, baseMagic;
    public int level;
    public List<string> magicNames = new List<string>();
    public Equipment equipedWeapon;
    public int relationship = 0;
}
      </code></pre>

      <p>
        Data is saved into separate JSON files (<code>team.json</code>, <code>inventory.json</code>, <code>story.json</code>)
        inside Unity’s <code>Application.persistentDataPath</code>, ensuring platform independence.
      </p>

      <h4>Saving Example</h4>
      <pre><code class="language-csharp">
public void SaveTeam()
{
    TeamData data = new TeamData();
    data.playerTeam = playerTeam;

    string json = JsonUtility.ToJson(data, true);
    File.WriteAllText(Path.Combine(Application.persistentDataPath, "team.json"), json);
    Debug.Log("Team saved successfully!");
}
      </code></pre>
    </section>

    <!-- SECTION 4: Dialogue System -->
    <section>
      <h2>Dialogue System</h2>
      <p>
        The dialogue engine is one of the key features of Xenokuni. Conversations are defined as structured JSON files
        containing lines, events, and parameters. These are dynamically interpreted by <code>DialogueManager</code>,
        allowing for <strong>branching narratives, camera control, combat triggers</strong>, and <strong>character movement</strong>.
      </p>

      <h4>Dialogue JSON Example</h4>
      <pre><code class="language-json">
{
  "dialogues": [
    {
      "dId": "campfire000",
      "lines": [
        { 
          "cId": "",
          "text": "It's getting late, do you want to sleep?",
          "events": [
            {
              "type": "branch",
              "parameters": [
                {"key": "first", "value": "Yes"},
                {"key": "second", "value": "No"},
                {"key": "script", "value": "campfire001"}
              ]
            }
          ]
        }
      ]
    }
  ]
}
      </code></pre>

      <h4>Processing Dialogue Events</h4>
      <pre><code class="language-csharp">
private void ProcessEvent(DialogueEvent dEvent)
{
    switch (dEvent.type)
    {
        case "fade": FadeEvent(dEvent.parameters); break;
        case "movechartopos": MoveCharacterToPosEventCall(dEvent.parameters); break;
        case "startcombat": StartCombatEvent(dEvent.parameters); break;
        case "branch": RealBranchEvent(dEvent.parameters); break;
        default: EventFinished(); break;
    }
}
      </code></pre>

      <p>
        This design allows new gameplay features to be added to the dialogue layer without modifying the engine itself —
        simply by defining new event types and handling them in <code>ProcessEvent()</code>.
      </p>
    </section>

    <!-- SECTION 5: Architecture Summary -->
    <section>
      <h2>Architecture Summary</h2>
      <ul>
        <li><strong>Engine:</strong> Unity + C# (.NET)</li>
        <li><strong>Combat:</strong> State Machine with modular transitions</li>
        <li><strong>Persistence:</strong> JSON serialization via <code>JsonUtility</code></li>
        <li><strong>Dialogue:</strong> JSON-driven event scripting with branching logic</li>
        <li><strong>Data Layer:</strong> PersistentData singleton managing saves and story triggers</li>
      </ul>
    </section>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</body>
</html>
